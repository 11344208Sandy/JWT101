<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>Authorize 測試頁</title>
</head>
<body>
    <h2>Authorize API 測試</h2>

    <div>
        <label for="name">Name：</label>
        <input id="name" type="text" value="JD1">
    </div>
    <div>
        <label for="password">Password：</label>
        <input id="password" type="password" value="123456789">
    </div>
    <br>
    <button onclick="callApi()">送出</button>

    <h3>回傳結果：</h3>
    <pre id="result"></pre>

    <script>
        async function callApi() {
            const name = document.getElementById('name').value;
            const password = document.getElementById('password').value;
            const resultEl = document.getElementById('result');
            resultEl.textContent = '呼叫中...';

            try {
                const response = await fetch('/api/Auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name: name,
                        password: password
                    })
                });

                // 檢查 API 是否成功
                if (!response.ok) {
                    const errorText = await response.text();
                    resultEl.textContent = `錯誤碼: ${response.status}\n訊息: ${errorText}`;
                    return;
                }

                const data = await response.json();

                // 修正 3: 成功拿到 Token 後存起來，並顯示結果
                if (data.token) {
                    localStorage.setItem("jwtToken", data.token); // 這行很重要，之後留言功能會用到
                    resultEl.textContent = "登入成功！Token 已儲存。\n\n" + JSON.stringify(data, null, 2);
                } else {
                    resultEl.textContent = JSON.stringify(data, null, 2);
                }

            } catch (err) {
                resultEl.textContent = '網路連線或系統錯誤：' + err;
            }
        }
    </script>
</body>
</html>
